{"updatedAt":"2025-12-16T12:36:59.109Z","createdAt":"2025-12-16T12:36:59.109Z","id":"7QXGhmxnsH4ncMJS","name":"æ— æ°´å°ä¸‹è½½","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"jsCode":"// n8n ChatèŠ‚ç‚¹URLæå–å™¨\n// ä¸“é—¨å¤„ç†ä»n8n ChatèŠ‚ç‚¹ä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯\n\n// ç¬¬ä¸€å¥ä»£ç ï¼šæ¥æ”¶n8n ChatèŠ‚ç‚¹ä¼ é€’çš„æ•°æ®\nconst chatMessage = $json.body;\n\nconsole.log('=== n8n ChatèŠ‚ç‚¹URLæå–å¼€å§‹ ===');\nconsole.log('æ¥æ”¶åˆ°çš„æ¶ˆæ¯ç±»å‹:', typeof chatMessage);\nconsole.log('åŸå§‹æ¶ˆæ¯å†…å®¹:', JSON.stringify(chatMessage, null, 2));\n\n/**\n * ä»Chatæ¶ˆæ¯ä¸­æå–æ–‡æœ¬å†…å®¹\n * @param {Object} message - ChatèŠ‚ç‚¹ä¼ é€’çš„æ¶ˆæ¯å¯¹è±¡\n * @returns {string} æå–åˆ°çš„æ–‡æœ¬å†…å®¹\n */\nfunction extractTextFromChatMessage(message) {\n    if (!message) {\n        return '';\n    }\n    \n    // ChatèŠ‚ç‚¹å¯èƒ½ä¼ é€’çš„ä¸åŒæ ¼å¼\n    if (typeof message === 'string') {\n        return message;\n    }\n    \n    if (typeof message === 'object') {\n        // å¸¸è§Chatæ¶ˆæ¯æ ¼å¼\n        if (message.text) {\n            return message.text;\n        }\n        if (message.message) {\n            return message.message;\n        }\n        if (message.content) {\n            return message.content;\n        }\n        if (message.body) {\n            return message.body;\n        }\n        \n        // å¦‚æœæ˜¯æ•°ç»„ï¼Œå°è¯•æå–ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ–‡æœ¬\n        if (Array.isArray(message) && message.length > 0) {\n            return extractTextFromChatMessage(message[0]);\n        }\n        \n        // å¦‚æœæ˜¯å¤æ‚å¯¹è±¡ï¼Œè½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n        return JSON.stringify(message);\n    }\n    \n    return String(message);\n}\n\n/**\n * ä»æ–‡æœ¬ä¸­æå–URLé“¾æ¥\n * @param {string} text - è¦å¤„ç†çš„æ–‡æœ¬\n * @returns {string|null} æå–åˆ°çš„URLé“¾æ¥\n */\nfunction extractUrlFromText(text) {\n    if (!text || typeof text !== 'string') {\n        console.log('âŒ æ–‡æœ¬å†…å®¹ä¸ºç©ºæˆ–ä¸æ˜¯å­—ç¬¦ä¸²');\n        return null;\n    }\n    \n    console.log('ğŸ“ å¤„ç†æ–‡æœ¬å†…å®¹:', text.substring(0, 100) + (text.length > 100 ? '...' : ''));\n    \n    // æ”¹è¿›çš„URLæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¯æŒæ›´å¤šæ ¼å¼ï¼Œé¿å…åŒ…å«ä¸­æ–‡æ ‡ç‚¹\n    const urlRegex = /https?:\\/\\/[^\\s\\\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n    const matches = text.match(urlRegex);\n    \n    if (matches && matches.length > 0) {\n        const foundUrl = matches[0];\n        console.log('âœ… æ‰¾åˆ°URL:', foundUrl);\n        return foundUrl;\n    } else {\n        console.log('âŒ æœªæ‰¾åˆ°URLé“¾æ¥');\n        return null;\n    }\n}\n\n/**\n * æå–æ‰€æœ‰URLé“¾æ¥\n * @param {string} text - è¦å¤„ç†çš„æ–‡æœ¬\n * @returns {string[]} æ‰€æœ‰æ‰¾åˆ°çš„URLé“¾æ¥\n */\nfunction extractAllUrlsFromText(text) {\n    if (!text || typeof text !== 'string') {\n        return [];\n    }\n    \n    const urlRegex = /https?:\\/\\/[^\\s\\\"<>{}|\\\\^`\\[\\]]+/gi;\n    const matches = text.match(urlRegex) || [];\n    \n    console.log(`ğŸ” æ‰¾åˆ° ${matches.length} ä¸ªURLé“¾æ¥`);\n    return matches;\n}\n\n// ä¸»å¤„ç†é€»è¾‘\nlet extractedText = '';\nlet voido_url = null;\nlet all_urls = [];\n\n// 1. ä»Chatæ¶ˆæ¯ä¸­æå–æ–‡æœ¬\nconsole.log('\\n--- æ­¥éª¤1: æå–æ–‡æœ¬å†…å®¹ ---');\nextractedText = extractTextFromChatMessage(chatMessage);\nconsole.log('âœ… æå–åˆ°çš„æ–‡æœ¬:', extractedText.substring(0, 150) + (extractedText.length > 150 ? '...' : ''));\n\n// 2. ä»æ–‡æœ¬ä¸­æå–URL\nconsole.log('\\n--- æ­¥éª¤2: æå–URLé“¾æ¥ ---');\nif (extractedText) {\n    voido_url = extractUrlFromText(extractedText);\n    all_urls = extractAllUrlsFromText(extractedText);\n}\n\n// 3. è¾“å‡ºç»“æœ\nconsole.log('\\n--- æœ€ç»ˆç»“æœ ---');\nif (voido_url) {\n    console.log('ğŸ‰ æˆåŠŸæå–åˆ°voido_url:', voido_url);\n    \n    // URLåˆ†æ\n    console.log('ğŸ“Š URLåˆ†æ:');\n    console.log('  - åè®®:', voido_url.startsWith('https') ? 'HTTPS' : 'HTTP');\n    console.log('  - åŸŸå:', voido_url.split('/')[2]);\n    console.log('  - è·¯å¾„:', voido_url.split('/').slice(3).join('/'));\n    \n    if (all_urls.length > 1) {\n        console.log('  - å…¶ä»–URL:', all_urls.slice(1));\n    }\n} else {\n    console.log('ğŸ’” æœªèƒ½æå–åˆ°URLé“¾æ¥');\n}\n\nconsole.log('\\n=== n8n ChatèŠ‚ç‚¹URLæå–ç»“æŸ ===');\n\n// è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nreturn {\n    voido_url: voido_url,\n    all_urls: all_urls,\n    extracted_text: extractedText,\n    success: !!voido_url,\n    message: voido_url ? `æˆåŠŸæå–${all_urls.length}ä¸ªURL` : 'æœªæ‰¾åˆ°URL',\n    url_count: all_urls.length,\n    original_message: chatMessage\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1696,208],"id":"8ff83c7c-8cbb-4557-93e8-5542a0967a70","name":"æå–URLåœ°å€"},{"parameters":{"assignments":{"assignments":[{"id":"29289767-439a-4e55-9c32-79c9c268335a","name":"platform","value":"={{ $json.platform }}","type":"string"},{"id":"c444a53b-7950-4e91-a224-1a324e209c98","name":"original_data.all_urls","value":"={{ $json.original_data.all_urls }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1248,208],"id":"1cdf135b-33ba-47bf-bfc6-13448d3c9c7b","name":"æ¸…ç†æ•°æ®ï¼Œä¿ç•™å¹³å°ä¿¡æ¯ä¸URL"},{"parameters":{"jsCode":"// n8n FunctionèŠ‚ç‚¹ - URLå¹³å°è¯†åˆ«å™¨\n// ç”¨äºè¯†åˆ«URLå±äºæŠ–éŸ³ã€å°çº¢ä¹¦ã€å¿«æ‰‹ç­‰å¹³å°\n\n// n8nå·¥ä½œæµæ•°æ®æ¥æ”¶\nconst response = $json;\n\nconsole.log('ğŸ” å¼€å§‹URLå¹³å°è¯†åˆ«...');\n\n// æå–URLå‡½æ•°\nfunction extractUrlFromData(data) {\n    if (!data) {\n        console.log('âŒ è¾“å…¥æ•°æ®ä¸ºç©º');\n        return null;\n    }\n    \n    // å¦‚æœæ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•ç›´æ¥æå–URL\n    if (typeof data === 'string') {\n        const urlRegex = /https?:\\/\\/[^\\s\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n        const matches = data.match(urlRegex);\n        if (matches && matches.length > 0) {\n            console.log(`âœ… ä»å­—ç¬¦ä¸²ä¸­æå–åˆ°URL: ${matches[0]}`);\n            return matches[0];\n        }\n    }\n    \n    // å¦‚æœæ•°æ®æ˜¯å¯¹è±¡ï¼Œæ·±åº¦æœç´¢URLå­—æ®µ\n    if (typeof data === 'object' && data !== null) {\n        // ä¼˜å…ˆæœç´¢å¸¸è§URLå­—æ®µ\n        const urlFields = ['url', 'link', 'href', 'video_url', 'douyin_url', 'xiaohongshu_url', 'kuaishou_url'];\n        \n        for (const field of urlFields) {\n            if (data[field] && typeof data[field] === 'string') {\n                const urlRegex = /https?:\\/\\/[^\\s\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n                const matches = data[field].match(urlRegex);\n                if (matches && matches.length > 0) {\n                    console.log(`âœ… ä»å­—æ®µ\"${field}\"ä¸­æå–åˆ°URL: ${matches[0]}`);\n                    return matches[0];\n                }\n            }\n        }\n        \n        // æ·±åº¦æœç´¢å¯¹è±¡ä¸­çš„URL\n        function deepSearch(obj) {\n            if (typeof obj === 'string') {\n                const urlRegex = /https?:\\/\\/[^\\s\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n                const matches = obj.match(urlRegex);\n                if (matches && matches.length > 0) {\n                    return matches[0];\n                }\n            } else if (typeof obj === 'object' && obj !== null) {\n                for (const key in obj) {\n                    if (obj.hasOwnProperty(key)) {\n                        const result = deepSearch(obj[key]);\n                        if (result) return result;\n                    }\n                }\n            }\n            return null;\n        }\n        \n        const foundUrl = deepSearch(data);\n        if (foundUrl) {\n            console.log(`âœ… æ·±åº¦æœç´¢æ‰¾åˆ°URL: ${foundUrl}`);\n            return foundUrl;\n        }\n    }\n    \n    console.log('âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„URL');\n    return null;\n}\n\n// URLå¹³å°è¯†åˆ«å‡½æ•°\nfunction identifyUrlPlatform(url) {\n    if (!url || typeof url !== 'string') {\n        return { \n            platform: 'invalid', \n            confidence: 0, \n            reason: 'æ— æ•ˆè¾“å…¥',\n            suggestion: 'è¯·æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„URL'\n        };\n    }\n    \n    console.log(`ğŸ” åˆ†æURL: ${url}`);\n    \n    // æŠ–éŸ³å¹³å°è¯†åˆ«è§„åˆ™\n    const douyinPatterns = [\n        /v\\.douyin\\.com/i,\n        /www\\.douyin\\.com/i,\n        /douyin\\.com/i,\n        /\\/D[0-9A-Za-z]{8,}\\/?/i\n    ];\n    \n    // å°çº¢ä¹¦å¹³å°è¯†åˆ«è§„åˆ™\n    const xiaohongshuPatterns = [\n        /www\\.xiaohongshu\\.com/i,\n        /xhslink\\.com/i,\n        /xiaohongshu\\.com/i,\n        /red/i,\n        /\\/discovery\\/item\\/[0-9a-f]+/i\n    ];\n    \n    // å¿«æ‰‹å¹³å°è¯†åˆ«è§„åˆ™\n    const kuaishouPatterns = [\n        /www\\.kuaishou\\.com/i,\n        /kuaishou\\.com/i,\n        /gifshow\\.com/i,\n        /\\/short-video\\//i,\n        /\\/photo\\//i\n    ];\n    \n    // å…¶ä»–å¹³å°è¯†åˆ«è§„åˆ™\n    const otherPlatforms = {\n        'bilibili': [/bilibili\\.com/i, /b23\\.tv/i],\n        'youtube': [/youtube\\.com/i, /youtu\\.be/i],\n        'weibo': [/weibo\\.com/i, /weibo\\.cn/i],\n        'zhihu': [/zhihu\\.com/i],\n        'tiktok': [/tiktok\\.com/i]\n    };\n    \n    // æ£€æŸ¥æŠ–éŸ³\n    for (const pattern of douyinPatterns) {\n        if (pattern.test(url)) {\n            return { \n                platform: 'douyin', \n                confidence: 0.9, \n                reason: 'åŒ¹é…æŠ–éŸ³URLæ¨¡å¼',\n                suggestion: 'è¿™æ˜¯ä¸€ä¸ªæŠ–éŸ³è§†é¢‘é“¾æ¥ï¼Œå¯ä»¥ç”¨äºæŠ–éŸ³ç›¸å…³å¤„ç†'\n            };\n        }\n    }\n    \n    // æ£€æŸ¥å°çº¢ä¹¦\n    for (const pattern of xiaohongshuPatterns) {\n        if (pattern.test(url)) {\n            return { \n                platform: 'xiaohongshu', \n                confidence: 0.9, \n                reason: 'åŒ¹é…å°çº¢ä¹¦URLæ¨¡å¼',\n                suggestion: 'è¿™æ˜¯ä¸€ä¸ªå°çº¢ä¹¦å†…å®¹é“¾æ¥ï¼Œå¯ä»¥ç”¨äºå°çº¢ä¹¦ç›¸å…³å¤„ç†'\n            };\n        }\n    }\n    \n    // æ£€æŸ¥å¿«æ‰‹\n    for (const pattern of kuaishouPatterns) {\n        if (pattern.test(url)) {\n            return { \n                platform: 'kuaishou', \n                confidence: 0.9, \n                reason: 'åŒ¹é…å¿«æ‰‹URLæ¨¡å¼',\n                suggestion: 'è¿™æ˜¯ä¸€ä¸ªå¿«æ‰‹è§†é¢‘é“¾æ¥ï¼Œå¯ä»¥ç”¨äºå¿«æ‰‹ç›¸å…³å¤„ç†'\n            };\n        }\n    }\n    \n    // æ£€æŸ¥å…¶ä»–å¹³å°\n    for (const [platform, patterns] of Object.entries(otherPlatforms)) {\n        for (const pattern of patterns) {\n            if (pattern.test(url)) {\n                return { \n                    platform: platform, \n                    confidence: 0.8, \n                    reason: `åŒ¹é…${platform} URLæ¨¡å¼`,\n                    suggestion: `è¿™æ˜¯ä¸€ä¸ª${platform}é“¾æ¥ï¼Œå¯ä»¥ç”¨äº${platform}ç›¸å…³å¤„ç†`\n                };\n            }\n        }\n    }\n    \n    // é€šç”¨URLåˆ†æ\n    try {\n        const urlObj = new URL(url);\n        const domain = urlObj.hostname;\n        \n        if (domain.includes('douyin')) {\n            return { \n                platform: 'douyin', \n                confidence: 0.7, \n                reason: 'åŸŸååŒ…å«douyin',\n                suggestion: 'è¿™å¯èƒ½æ˜¯æŠ–éŸ³ç›¸å…³é“¾æ¥ï¼Œå»ºè®®è¿›ä¸€æ­¥éªŒè¯'\n            };\n        }\n        \n        if (domain.includes('xiaohongshu') || domain.includes('red')) {\n            return { \n                platform: 'xiaohongshu', \n                confidence: 0.7, \n                reason: 'åŸŸååŒ…å«å°çº¢ä¹¦ç›¸å…³å…³é”®è¯',\n                suggestion: 'è¿™å¯èƒ½æ˜¯å°çº¢ä¹¦ç›¸å…³é“¾æ¥ï¼Œå»ºè®®è¿›ä¸€æ­¥éªŒè¯'\n            };\n        }\n        \n        if (domain.includes('kuaishou') || domain.includes('gifshow')) {\n            return { \n                platform: 'kuaishou', \n                confidence: 0.7, \n                reason: 'åŸŸååŒ…å«å¿«æ‰‹ç›¸å…³å…³é”®è¯',\n                suggestion: 'è¿™å¯èƒ½æ˜¯å¿«æ‰‹ç›¸å…³é“¾æ¥ï¼Œå»ºè®®è¿›ä¸€æ­¥éªŒè¯'\n            };\n        }\n        \n        return { \n            platform: 'unknown', \n            confidence: 0.3, \n            reason: `æ— æ³•è¯†åˆ«çš„åŸŸå: ${domain}`,\n            suggestion: 'è¿™æ˜¯ä¸€ä¸ªæœªçŸ¥å¹³å°çš„é“¾æ¥ï¼Œå¯èƒ½éœ€è¦è‡ªå®šä¹‰å¤„ç†'\n        };\n        \n    } catch (error) {\n        return { \n            platform: 'invalid', \n            confidence: 0, \n            reason: 'æ— æ•ˆçš„URLæ ¼å¼',\n            suggestion: 'è¯·æ£€æŸ¥URLæ ¼å¼æ˜¯å¦æ­£ç¡®'\n        };\n    }\n}\n\n// è·å–å¹³å°å¤„ç†å»ºè®®\nfunction getPlatformSuggestion(platform) {\n    const suggestions = {\n        'douyin': {\n            action: 'æŠ–éŸ³è§†é¢‘å¤„ç†',\n            steps: ['è§£æè§†é¢‘ID', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘å†…å®¹'],\n            tools: ['æŠ–éŸ³API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'xiaohongshu': {\n            action: 'å°çº¢ä¹¦å†…å®¹å¤„ç†',\n            steps: ['è§£æç¬”è®°ID', 'è·å–ç¬”è®°è¯¦æƒ…', 'æå–å›¾ç‰‡/æ–‡å­—'],\n            tools: ['å°çº¢ä¹¦API', 'å†…å®¹è§£æå™¨']\n        },\n        'kuaishou': {\n            action: 'å¿«æ‰‹è§†é¢‘å¤„ç†',\n            steps: ['è§£æè§†é¢‘ID', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘å†…å®¹'],\n            tools: ['å¿«æ‰‹API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'bilibili': {\n            action: 'Bç«™è§†é¢‘å¤„ç†',\n            steps: ['è§£æBVå·', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘'],\n            tools: ['Bç«™API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'youtube': {\n            action: 'YouTubeè§†é¢‘å¤„ç†',\n            steps: ['è§£æè§†é¢‘ID', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘'],\n            tools: ['YouTube API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'unknown': {\n            action: 'é€šç”¨é“¾æ¥å¤„ç†',\n            steps: ['åˆ†æé“¾æ¥ç»“æ„', 'æå–å…³é”®ä¿¡æ¯', 'è‡ªå®šä¹‰å¤„ç†'],\n            tools: ['é€šç”¨çˆ¬è™«', 'è‡ªå®šä¹‰è§£æå™¨']\n        }\n    };\n    \n    return suggestions[platform] || {\n        action: 'æœªçŸ¥å¹³å°å¤„ç†',\n        steps: ['åˆ†æé“¾æ¥ç‰¹å¾', 'ç¡®å®šå¤„ç†ç­–ç•¥'],\n        tools: ['é€šç”¨å·¥å…·']\n    };\n}\n\n// ä¸»å¤„ç†é€»è¾‘\nfunction main() {\n    console.log('ğŸ“¥ æ¥æ”¶åˆ°çš„æ•°æ®:', JSON.stringify(response, null, 2));\n    \n    // æå–URL\n    const url = extractUrlFromData(response);\n    \n    if (!url) {\n        return {\n            success: false,\n            message: 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„URL',\n            original_data: response,\n            platform: 'none',  // æ— URLæ—¶çš„å¹³å°æ ‡è¯†\n            platform_info: {\n                platform: 'none',\n                confidence: 0,\n                reason: 'æœªæ‰¾åˆ°URL',\n                suggestion: 'è¯·ç¡®ä¿è¾“å…¥æ•°æ®åŒ…å«æœ‰æ•ˆçš„URLé“¾æ¥'\n            }\n        };\n    }\n    \n    // è¯†åˆ«å¹³å°\n    const platformResult = identifyUrlPlatform(url);\n    \n    // è·å–å¤„ç†å»ºè®®\n    const suggestion = getPlatformSuggestion(platformResult.platform);\n    \n    console.log(`ğŸ¯ è¯†åˆ«ç»“æœ: ${platformResult.platform} (ç½®ä¿¡åº¦: ${platformResult.confidence})`);\n    console.log(`ğŸ“ åŸå› : ${platformResult.reason}`);\n    console.log(`ğŸ’¡ å»ºè®®: ${platformResult.suggestion}`);\n    \n    return {\n        success: true,\n        message: 'URLå¹³å°è¯†åˆ«æˆåŠŸ',\n        original_data: response,\n        url: url,\n        platform: platformResult.platform,  // ç›´æ¥å¹³å°æ ‡è¯†ï¼šdouyin, xiaohongshu, kuaishou, bilibiliç­‰\n        platform_info: platformResult,\n        processing_suggestion: suggestion\n    };\n}\n\n// æ‰§è¡Œä¸»å‡½æ•°å¹¶è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nconst result = main();\nconsole.log('âœ… URLå¹³å°è¯†åˆ«å®Œæˆ');\n\nreturn result;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1472,208],"id":"9fb3b040-9c08-4b1f-a53b-ab13713bef37","name":"è·å–å¹³å°ä¿¡æ¯"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"leftValue":"={{ $json.platform }}","rightValue":"douyin","operator":{"type":"string","operation":"equals"},"id":"cfda8ab8-ee00-4101-b395-561d0c6cf25f"}],"combinator":"and"},"renameOutput":true,"outputKey":"douyin"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"2fdbc1f3-d2b7-4fa1-ad5d-a7c4755d1ca7","leftValue":"={{ $json.platform }}","rightValue":"xiaohongshu","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"xiaohongshu"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"1f949a8b-ffea-4ec6-9cae-8bb0ffd77cd7","leftValue":"={{ $json.platform }}","rightValue":"kuaishou","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"kuaishou"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"6602bd66-0403-4bb9-ba59-79341e2736cd","leftValue":"={{ $json.platform }}","rightValue":"bilibili","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"bilibili"}]},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[-1024,176],"id":"f107a45b-dbd0-4367-ba6c-7ee98c958ad0","name":"æ ¹æ®ä¿¡æ¯é€‰æ‹©å¯¹åº”å·¥ä½œæµ"},{"parameters":{"url":"https://api.bugpk.com/api/douyin","sendQuery":true,"queryParameters":{"parameters":[{"name":"=url","value":"={{ $json.original_data.all_urls[0] }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Accept","value":"application/json"}]},"options":{"allowUnauthorizedCerts":true}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-800,112],"id":"8a3eaf45-acb1-4a1e-8389-52b9cdc47e42","name":"æŠ–éŸ³è§†é¢‘è§£æè·å–åœ°å€"},{"parameters":{"url":"https://api.bugpk.com/api/xhsjx","sendQuery":true,"queryParameters":{"parameters":[{"name":"=url","value":"={{ $json.original_data.all_urls[0] }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Accept","value":"application/json"}]},"options":{"allowUnauthorizedCerts":true}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-800,304],"id":"ad7d9cad-0a95-4f40-988c-a2667fbab684","name":"å°çº¢ä¹¦è§£æè·å–åœ°å€"},{"parameters":{"jsCode":"// n8n FunctionèŠ‚ç‚¹ - æ£€æŸ¥JSONæ•°æ®ä¸­çš„imgurlå‚æ•°\n// å¦‚æœæœ‰imgurlå‚æ•°ï¼Œè¿”å›imgurlå’Œå†…å®¹ï¼›å¦‚æœæ²¡æœ‰ï¼Œè¿”å›urlå’Œå†…å®¹\n\n// n8nå·¥ä½œæµæ•°æ®æ¥æ”¶\nconst response = $json;\n\nconsole.log('ğŸ” å¼€å§‹æ£€æŸ¥JSONæ•°æ®ä¸­çš„å›¾ç‰‡å‚æ•°...');\n\n// ä¸»å¤„ç†å‡½æ•°\nfunction checkImgUrlParameter(data) {\n    console.log('ğŸ“¥ è¾“å…¥æ•°æ®:', JSON.stringify(data, null, 2));\n    \n    // æ£€æŸ¥æ•°æ®æ ¼å¼\n    if (!data || typeof data !== 'object') {\n        return {\n            success: false,\n            message: 'è¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null\n        };\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰dataå­—æ®µ\n    if (!data.data || typeof data.data !== 'object') {\n        return {\n            success: false,\n            message: 'ç¼ºå°‘dataå­—æ®µæˆ–dataå­—æ®µæ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null\n        };\n    }\n    \n    const dataObj = data.data;\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰imgurlå‚æ•°\n    if (dataObj.hasOwnProperty('imgurl')) {\n        console.log('âœ… æ‰¾åˆ°imgurlå‚æ•°');\n        \n        // å¤„ç†imgurlå†…å®¹\n        let imgurlContent = dataObj.imgurl;\n        \n        // å¦‚æœimgurlæ˜¯æ•°ç»„ï¼Œå¤„ç†æ•°ç»„å†…å®¹\n        if (Array.isArray(imgurlContent)) {\n            console.log(`ğŸ“· imgurlæ˜¯æ•°ç»„ï¼ŒåŒ…å« ${imgurlContent.length} ä¸ªå…ƒç´ `);\n            \n            // æ¸…ç†å’Œæ ¼å¼åŒ–æ•°ç»„å†…å®¹\n            const cleanedImgUrls = imgurlContent.map(url => {\n                // å»é™¤URLä¸¤ç«¯çš„ç©ºæ ¼å’Œåå¼•å·\n                return url.trim().replace(/^`|`$/g, '').trim();\n            });\n            \n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imgurlå‚æ•°ï¼ˆæ•°ç»„æ ¼å¼ï¼‰',\n                parameter_type: 'imgurl',\n                parameter_value: cleanedImgUrls,\n                count: cleanedImgUrls.length,\n                result: {\n                    imgurl: cleanedImgUrls\n                }\n            };\n        } \n        // å¦‚æœimgurlæ˜¯å­—ç¬¦ä¸²\n        else if (typeof imgurlContent === 'string') {\n            console.log('ğŸ“· imgurlæ˜¯å­—ç¬¦ä¸²');\n            \n            // æ¸…ç†å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å†…å®¹\n            const cleanedImgUrl = imgurlContent.trim().replace(/^`|`$/g, '').trim();\n            \n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imgurlå‚æ•°ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰',\n                parameter_type: 'imgurl',\n                parameter_value: cleanedImgUrl,\n                count: 1,\n                result: {\n                    imgurl: cleanedImgUrl\n                }\n            };\n        }\n        // å…¶ä»–æ ¼å¼çš„imgurl\n        else {\n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imgurlå‚æ•°ï¼ˆå…¶ä»–æ ¼å¼ï¼‰',\n                parameter_type: 'imgurl',\n                parameter_value: imgurlContent,\n                count: 1,\n                result: {\n                    imgurl: imgurlContent\n                }\n            };\n        }\n    }\n    // æ£€æŸ¥æ˜¯å¦æœ‰urlå‚æ•°\n    else if (dataObj.hasOwnProperty('url')) {\n        console.log('âœ… æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°');\n        \n        let urlContent = dataObj.url;\n        \n        // å¤„ç†urlå†…å®¹\n        if (typeof urlContent === 'string') {\n            const cleanedUrl = urlContent.trim().replace(/^`|`$/g, '').trim();\n            \n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: cleanedUrl,\n                count: 1,\n                result: {\n                    url: cleanedUrl\n                }\n            };\n        } else {\n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: urlContent,\n                count: 1,\n                result: {\n                    url: urlContent\n                }\n            };\n        }\n    }\n    // æ£€æŸ¥å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n    else {\n        console.log('ğŸ” æœªæ‰¾åˆ°imgurlå’Œurlå‚æ•°ï¼Œæœç´¢å…¶ä»–å›¾ç‰‡ç›¸å…³å­—æ®µ...');\n        \n        // æœç´¢å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n        const imageFields = ['image', 'cover', 'avatar', 'picture', 'pic', 'thumbnail'];\n        let foundField = null;\n        let foundValue = null;\n        \n        for (const field of imageFields) {\n            if (dataObj.hasOwnProperty(field)) {\n                foundField = field;\n                foundValue = dataObj[field];\n                break;\n            }\n        }\n        \n        if (foundField) {\n            console.log(`âœ… æ‰¾åˆ°æ›¿ä»£å­—æ®µ: ${foundField}`);\n            \n            // å¤„ç†æ‰¾åˆ°çš„å­—æ®µå†…å®¹\n            if (typeof foundValue === 'string') {\n                const cleanedValue = foundValue.trim().replace(/^`|`$/g, '').trim();\n                \n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: cleanedValue,\n                    count: 1,\n                    result: {\n                        [foundField]: cleanedValue\n                    }\n                };\n            } else {\n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: foundValue,\n                    count: 1,\n                    result: {\n                        [foundField]: foundValue\n                    }\n                };\n            }\n        } else {\n            console.log('âŒ æœªæ‰¾åˆ°ä»»ä½•å›¾ç‰‡ç›¸å…³å‚æ•°');\n            \n            return {\n                success: false,\n                message: 'æœªæ‰¾åˆ°imgurlã€urlæˆ–å…¶ä»–å›¾ç‰‡ç›¸å…³å‚æ•°',\n                parameter_type: 'none',\n                parameter_value: null,\n                count: 0,\n                result: null\n            };\n        }\n    }\n}\n\n// æ‰§è¡Œä¸»å‡½æ•°\nconsole.log('ğŸ¯ å¼€å§‹å¤„ç†n8nå·¥ä½œæµæ•°æ®...');\nconst result = checkImgUrlParameter(response);\n\nconsole.log('ğŸ“Š å¤„ç†ç»“æœ:');\nconsole.log(`  - æˆåŠŸ: ${result.success}`);\nconsole.log(`  - æ¶ˆæ¯: ${result.message}`);\nconsole.log(`  - å‚æ•°ç±»å‹: ${result.parameter_type}`);\nconsole.log(`  - æ•°é‡: ${result.count}`);\n\nif (result.success && result.result) {\n    console.log(`  - è¿”å›å†…å®¹: ${JSON.stringify(result.result, null, 2)}`);\n}\n\nconsole.log('âœ… JSONæ•°æ®æ£€æŸ¥å®Œæˆ');\n\n// è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nreturn result;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-576,304],"id":"d1999dd8-0b74-4879-9b2d-579611b8f6f6","name":"Code in JavaScript"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.parameter_type }}","rightValue":"imgurl","operator":{"type":"string","operation":"equals"},"id":"b044f1ca-d03c-4a69-99f2-a7eb70763c4f"}],"combinator":"and"},"renameOutput":true,"outputKey":"imgurl"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ccb7c462-386a-4010-8208-c6befda57001","leftValue":"={{ $json.parameter_type }}","rightValue":"url","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"url"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[-352,304],"id":"6dc7a042-849e-4b24-9ab9-bf154a6f8bb9","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"20abeee6-b5a5-46f9-b885-ed62786f134c","name":"url","value":"={{ $json.result.url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,432],"id":"6fb9d3bc-75d0-49c6-b439-490fc354a724","name":"å°çº¢ä¹¦è§†é¢‘è§£æ"},{"parameters":{"assignments":{"assignments":[{"id":"f70cb110-186a-487c-bf6d-1f1017f9b1c5","name":"images","value":"={{ $json.result.imgurl }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,144],"id":"7c1a04bd-4b78-4176-a6fa-590785fb293e","name":"å°çº¢ä¹¦å›¾ç‰‡è§£æ"},{"parameters":{"jsCode":"// n8n FunctionèŠ‚ç‚¹ - æ£€æŸ¥JSONæ•°æ®ä¸­çš„imageså‚æ•°\n// å¦‚æœæœ‰imageså‚æ•°ï¼Œè¿”å›imageså’Œå†…å®¹ï¼›å¦‚æœæ²¡æœ‰ï¼Œè¿”å›urlå’Œå†…å®¹\n\n// n8nå·¥ä½œæµæ•°æ®æ¥æ”¶\nconst response = $json;\n\nconsole.log('ğŸ” å¼€å§‹æ£€æŸ¥JSONæ•°æ®ä¸­çš„å›¾ç‰‡å‚æ•°...');\n\n// ä¸»å¤„ç†å‡½æ•°\nfunction checkImagesParameter(data) {\n    console.log('ğŸ“¥ è¾“å…¥æ•°æ®:', JSON.stringify(data, null, 2));\n    \n    // æ£€æŸ¥æ•°æ®æ ¼å¼\n    if (!data || typeof data !== 'object') {\n        return {\n            success: false,\n            message: 'è¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null,\n            count: 0\n        };\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰dataå­—æ®µ\n    if (!data.data || typeof data.data !== 'object') {\n        return {\n            success: false,\n            message: 'ç¼ºå°‘dataå­—æ®µæˆ–dataå­—æ®µæ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null,\n            count: 0\n        };\n    }\n    \n    const dataObj = data.data;\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰imageså‚æ•°ä¸”ä¸ä¸ºç©º\n    if (dataObj.hasOwnProperty('images') && dataObj.images != null) {\n        console.log('âœ… æ‰¾åˆ°imageså‚æ•°');\n        \n        // å¤„ç†imageså†…å®¹\n        let imagesContent = dataObj.images;\n        \n        // æ£€æŸ¥imagesæ˜¯å¦ä¸ºç©º\n        let isEmpty = false;\n        \n        // å¦‚æœimagesæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºç©ºæ•°ç»„\n        if (Array.isArray(imagesContent)) {\n            if (imagesContent.length === 0) {\n                console.log('âš ï¸ imagesæ˜¯ç©ºæ•°ç»„ï¼Œè§†ä¸ºä¸å­˜åœ¨');\n                isEmpty = true;\n            } else {\n                console.log(`ğŸ“· imagesæ˜¯æ•°ç»„ï¼ŒåŒ…å« ${imagesContent.length} ä¸ªå…ƒç´ `);\n                \n                // æ¸…ç†å’Œæ ¼å¼åŒ–æ•°ç»„å†…å®¹\n                const cleanedImages = imagesContent.map(url => {\n                    // å»é™¤URLä¸¤ç«¯çš„ç©ºæ ¼å’Œåå¼•å·\n                    return url.trim().replace(/^`|`$/g, '').trim();\n                });\n                \n                return {\n                    success: true,\n                    message: 'æ‰¾åˆ°imageså‚æ•°ï¼ˆæ•°ç»„æ ¼å¼ï¼‰',\n                    parameter_type: 'images',\n                    parameter_value: cleanedImages,\n                    count: cleanedImages.length,\n                    result: {\n                        images: cleanedImages\n                    }\n                };\n            }\n        } \n        // å¦‚æœimagesæ˜¯å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²\n        else if (typeof imagesContent === 'string') {\n            if (imagesContent.trim() === '') {\n                console.log('âš ï¸ imagesæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè§†ä¸ºä¸å­˜åœ¨');\n                isEmpty = true;\n            } else {\n                console.log('ğŸ“· imagesæ˜¯å­—ç¬¦ä¸²');\n                \n                // æ¸…ç†å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å†…å®¹\n                const cleanedImage = imagesContent.trim().replace(/^`|`$/g, '').trim();\n                \n                return {\n                    success: true,\n                    message: 'æ‰¾åˆ°imageså‚æ•°ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰',\n                    parameter_type: 'images',\n                    parameter_value: cleanedImage,\n                    count: 1,\n                    result: {\n                        images: cleanedImage\n                    }\n                };\n            }\n        }\n        // å…¶ä»–æ ¼å¼çš„imagesï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºnullæˆ–undefined\n        else if (imagesContent === null || imagesContent === undefined) {\n            console.log('âš ï¸ imagesæ˜¯nullæˆ–undefinedï¼Œè§†ä¸ºä¸å­˜åœ¨');\n            isEmpty = true;\n        }\n        // å…¶ä»–æ ¼å¼çš„images\n        else {\n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imageså‚æ•°ï¼ˆå…¶ä»–æ ¼å¼ï¼‰',\n                parameter_type: 'images',\n                parameter_value: imagesContent,\n                count: 1,\n                result: {\n                    images: imagesContent\n                }\n            };\n        }\n        \n        // å¦‚æœimagesä¸ºç©ºï¼Œç»§ç»­æ£€æŸ¥å…¶ä»–å‚æ•°\n        if (isEmpty) {\n            console.log('ğŸ” imageså‚æ•°ä¸ºç©ºï¼Œç»§ç»­æ£€æŸ¥å…¶ä»–å‚æ•°...');\n        } else {\n            // å¦‚æœimagesä¸ä¸ºç©ºï¼Œç›´æ¥è¿”å›ç»“æœ\n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imageså‚æ•°',\n                parameter_type: 'images',\n                parameter_value: imagesContent,\n                count: 1,\n                result: {\n                    images: imagesContent\n                }\n            };\n        }\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰urlå‚æ•°ä¸”ä¸ä¸ºç©º\n    if (dataObj.hasOwnProperty('url') && dataObj.url != null) {\n        console.log('âœ… æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°');\n        \n        let urlContent = dataObj.url;\n        \n        // å¤„ç†urlå†…å®¹\n        if (typeof urlContent === 'string') {\n            const cleanedUrl = urlContent.trim().replace(/^`|`$/g, '').trim();\n            \n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: cleanedUrl,\n                count: 1,\n                result: {\n                    url: cleanedUrl\n                }\n            };\n        } else {\n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: urlContent,\n                count: 1,\n                result: {\n                    url: urlContent\n                }\n            };\n        }\n    }\n    // æ£€æŸ¥å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n    else {\n        console.log('ğŸ” æœªæ‰¾åˆ°imageså’Œurlå‚æ•°ï¼Œæœç´¢å…¶ä»–å›¾ç‰‡ç›¸å…³å­—æ®µ...');\n        \n        // æœç´¢å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n        const imageFields = ['image', 'cover', 'avatar', 'picture', 'pic', 'thumbnail', 'imgurl'];\n        let foundField = null;\n        let foundValue = null;\n        \n        for (const field of imageFields) {\n            if (dataObj.hasOwnProperty(field)) {\n                foundField = field;\n                foundValue = dataObj[field];\n                break;\n            }\n        }\n        \n        if (foundField) {\n            console.log(`âœ… æ‰¾åˆ°æ›¿ä»£å­—æ®µ: ${foundField}`);\n            \n            // å¤„ç†æ‰¾åˆ°çš„å­—æ®µå†…å®¹\n            if (typeof foundValue === 'string') {\n                const cleanedValue = foundValue.trim().replace(/^`|`$/g, '').trim();\n                \n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: cleanedValue,\n                    count: 1,\n                    result: {\n                        [foundField]: cleanedValue\n                    }\n                };\n            } else {\n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: foundValue,\n                    count: 1,\n                    result: {\n                        [foundField]: foundValue\n                    }\n                };\n            }\n        } else {\n            console.log('âŒ æœªæ‰¾åˆ°ä»»ä½•å›¾ç‰‡ç›¸å…³å‚æ•°');\n            \n            return {\n                success: false,\n                message: 'æœªæ‰¾åˆ°imagesã€urlæˆ–å…¶ä»–å›¾ç‰‡ç›¸å…³å‚æ•°',\n                parameter_type: 'none',\n                parameter_value: null,\n                count: 0,\n                result: null\n            };\n        }\n    }\n}\n\n// æ‰§è¡Œä¸»å‡½æ•°\nconsole.log('ğŸ¯ å¼€å§‹å¤„ç†n8nå·¥ä½œæµæ•°æ®...');\nconst result = checkImagesParameter(response);\n\nconsole.log('ğŸ“Š å¤„ç†ç»“æœ:');\nconsole.log(`  - æˆåŠŸ: ${result.success}`);\nconsole.log(`  - æ¶ˆæ¯: ${result.message}`);\nconsole.log(`  - å‚æ•°ç±»å‹: ${result.parameter_type}`);\nconsole.log(`  - æ•°é‡: ${result.count}`);\n\nif (result.success && result.result) {\n    console.log(`  - è¿”å›å†…å®¹: ${JSON.stringify(result.result, null, 2)}`);\n}\n\nconsole.log('âœ… JSONæ•°æ®æ£€æŸ¥å®Œæˆ');\n\n// è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nreturn result;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-592,112],"id":"8583360d-7c56-4734-8dd5-f61a658cfb24","name":"Code in JavaScript1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.parameter_type }}","rightValue":"images","operator":{"type":"string","operation":"equals"},"id":"34bc6e42-7808-4669-862f-fee0b11f0c87"}],"combinator":"and"},"renameOutput":true,"outputKey":"images"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"065c7439-48cf-409f-bf40-c9c985bd9e94","leftValue":"={{ $json.parameter_type }}","rightValue":"url","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"url"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[-384,112],"id":"aae02ae5-9b6d-41a2-ae0a-9ddface7094b","name":"Switch1"},{"parameters":{"assignments":{"assignments":[{"id":"b3ef2a19-e2cd-4d48-96e0-f34fdcc51df0","name":"images","value":"={{ $json.result.images }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,0],"id":"fb130098-be10-4044-9000-41e7d62f1cdc","name":"æŠ–éŸ³å›¾ç‰‡è§£æ"},{"parameters":{"assignments":{"assignments":[{"id":"4d042191-8af8-4937-ae4c-301bb07a5028","name":"url","value":"={{ $json.result.url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,288],"id":"d5ad7c76-9b2b-4daa-b701-6911759b40c6","name":"æŠ–éŸ³è§†é¢‘è§£æ"},{"parameters":{"aggregate":"aggregateAllItemData","options":{"includeBinaries":true}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[304,64],"id":"98880f8f-be19-4f00-ab3e-afe1854412ef","name":"Aggregate"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[304,352],"id":"592005f9-2188-45d2-9c0d-18ae6f79ecc8","name":"Aggregate1"},{"parameters":{"httpMethod":"POST","path":"parserAll","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1952,208],"id":"f9f2bacf-51cb-4b0f-a7b7-6929d54fe702","name":"Webhook","webhookId":"2913aca4-3fb9-4ad9-a5ee-09f50d10aea1"},{"parameters":{"respondWith":"allIncomingItems","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[608,64],"id":"ee2e4361-9a94-4801-bd41-ae25e6ab01be","name":"Respond to Webhook"},{"parameters":{"respondWith":"allIncomingItems","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[608,352],"id":"8aac7940-1008-420b-983d-889562f85e55","name":"Respond to Webhook1"}],"connections":{"æå–URLåœ°å€":{"main":[[{"node":"è·å–å¹³å°ä¿¡æ¯","type":"main","index":0}]]},"è·å–å¹³å°ä¿¡æ¯":{"main":[[{"node":"æ¸…ç†æ•°æ®ï¼Œä¿ç•™å¹³å°ä¿¡æ¯ä¸URL","type":"main","index":0}]]},"æ¸…ç†æ•°æ®ï¼Œä¿ç•™å¹³å°ä¿¡æ¯ä¸URL":{"main":[[{"node":"æ ¹æ®ä¿¡æ¯é€‰æ‹©å¯¹åº”å·¥ä½œæµ","type":"main","index":0}]]},"æ ¹æ®ä¿¡æ¯é€‰æ‹©å¯¹åº”å·¥ä½œæµ":{"main":[[{"node":"æŠ–éŸ³è§†é¢‘è§£æè·å–åœ°å€","type":"main","index":0}],[{"node":"å°çº¢ä¹¦è§£æè·å–åœ°å€","type":"main","index":0}]]},"æŠ–éŸ³è§†é¢‘è§£æè·å–åœ°å€":{"main":[[{"node":"Code in JavaScript1","type":"main","index":0}]]},"å°çº¢ä¹¦è§£æè·å–åœ°å€":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"å°çº¢ä¹¦å›¾ç‰‡è§£æ","type":"main","index":0}],[{"node":"å°çº¢ä¹¦è§†é¢‘è§£æ","type":"main","index":0}]]},"Code in JavaScript1":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"æŠ–éŸ³å›¾ç‰‡è§£æ","type":"main","index":0}],[{"node":"æŠ–éŸ³è§†é¢‘è§£æ","type":"main","index":0}]]},"æŠ–éŸ³è§†é¢‘è§£æ":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"å°çº¢ä¹¦è§†é¢‘è§£æ":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"æŠ–éŸ³å›¾ç‰‡è§£æ":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"å°çº¢ä¹¦å›¾ç‰‡è§£æ":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"æå–URLåœ°å€","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"65676e64-145e-4f0c-80c9-e4d128aa3b49","activeVersionId":"65676e64-145e-4f0c-80c9-e4d128aa3b49","versionCounter":3,"triggerCount":1,"shared":[{"updatedAt":"2025-12-16T12:36:59.120Z","createdAt":"2025-12-16T12:36:59.120Z","role":"workflow:owner","workflowId":"7QXGhmxnsH4ncMJS","projectId":"2hoECj5RzPkbXIK6","project":{"updatedAt":"2025-12-16T12:31:47.827Z","createdAt":"2025-12-16T12:30:18.158Z","id":"2hoECj5RzPkbXIK6","name":"å†· å¸ƒä¸ <498128186@qq.com>","type":"personal","icon":null,"description":null,"projectRelations":[{"updatedAt":"2025-12-16T12:30:18.159Z","createdAt":"2025-12-16T12:30:18.159Z","userId":"c46ce840-de81-412d-a160-69fb3885a0dd","projectId":"2hoECj5RzPkbXIK6","user":{"updatedAt":"2025-12-17T05:04:54.000Z","createdAt":"2025-12-16T12:30:17.247Z","id":"c46ce840-de81-412d-a160-69fb3885a0dd","email":"498128186@qq.com","firstName":"å†·","lastName":"å¸ƒä¸","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-12-16T12:31:51.645Z","personalization_survey_n8n_version":"2.0.2"},"settings":{"userActivated":false,"easyAIWorkflowOnboarded":true},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2025-12-17","isPending":false}}]}}],"tags":[],"activeVersion":{"updatedAt":"2025-12-16T12:40:44.000Z","createdAt":"2025-12-16T12:36:59.124Z","versionId":"65676e64-145e-4f0c-80c9-e4d128aa3b49","workflowId":"7QXGhmxnsH4ncMJS","nodes":[{"parameters":{"jsCode":"// n8n ChatèŠ‚ç‚¹URLæå–å™¨\n// ä¸“é—¨å¤„ç†ä»n8n ChatèŠ‚ç‚¹ä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯\n\n// ç¬¬ä¸€å¥ä»£ç ï¼šæ¥æ”¶n8n ChatèŠ‚ç‚¹ä¼ é€’çš„æ•°æ®\nconst chatMessage = $json.body;\n\nconsole.log('=== n8n ChatèŠ‚ç‚¹URLæå–å¼€å§‹ ===');\nconsole.log('æ¥æ”¶åˆ°çš„æ¶ˆæ¯ç±»å‹:', typeof chatMessage);\nconsole.log('åŸå§‹æ¶ˆæ¯å†…å®¹:', JSON.stringify(chatMessage, null, 2));\n\n/**\n * ä»Chatæ¶ˆæ¯ä¸­æå–æ–‡æœ¬å†…å®¹\n * @param {Object} message - ChatèŠ‚ç‚¹ä¼ é€’çš„æ¶ˆæ¯å¯¹è±¡\n * @returns {string} æå–åˆ°çš„æ–‡æœ¬å†…å®¹\n */\nfunction extractTextFromChatMessage(message) {\n    if (!message) {\n        return '';\n    }\n    \n    // ChatèŠ‚ç‚¹å¯èƒ½ä¼ é€’çš„ä¸åŒæ ¼å¼\n    if (typeof message === 'string') {\n        return message;\n    }\n    \n    if (typeof message === 'object') {\n        // å¸¸è§Chatæ¶ˆæ¯æ ¼å¼\n        if (message.text) {\n            return message.text;\n        }\n        if (message.message) {\n            return message.message;\n        }\n        if (message.content) {\n            return message.content;\n        }\n        if (message.body) {\n            return message.body;\n        }\n        \n        // å¦‚æœæ˜¯æ•°ç»„ï¼Œå°è¯•æå–ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ–‡æœ¬\n        if (Array.isArray(message) && message.length > 0) {\n            return extractTextFromChatMessage(message[0]);\n        }\n        \n        // å¦‚æœæ˜¯å¤æ‚å¯¹è±¡ï¼Œè½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n        return JSON.stringify(message);\n    }\n    \n    return String(message);\n}\n\n/**\n * ä»æ–‡æœ¬ä¸­æå–URLé“¾æ¥\n * @param {string} text - è¦å¤„ç†çš„æ–‡æœ¬\n * @returns {string|null} æå–åˆ°çš„URLé“¾æ¥\n */\nfunction extractUrlFromText(text) {\n    if (!text || typeof text !== 'string') {\n        console.log('âŒ æ–‡æœ¬å†…å®¹ä¸ºç©ºæˆ–ä¸æ˜¯å­—ç¬¦ä¸²');\n        return null;\n    }\n    \n    console.log('ğŸ“ å¤„ç†æ–‡æœ¬å†…å®¹:', text.substring(0, 100) + (text.length > 100 ? '...' : ''));\n    \n    // æ”¹è¿›çš„URLæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¯æŒæ›´å¤šæ ¼å¼ï¼Œé¿å…åŒ…å«ä¸­æ–‡æ ‡ç‚¹\n    const urlRegex = /https?:\\/\\/[^\\s\\\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n    const matches = text.match(urlRegex);\n    \n    if (matches && matches.length > 0) {\n        const foundUrl = matches[0];\n        console.log('âœ… æ‰¾åˆ°URL:', foundUrl);\n        return foundUrl;\n    } else {\n        console.log('âŒ æœªæ‰¾åˆ°URLé“¾æ¥');\n        return null;\n    }\n}\n\n/**\n * æå–æ‰€æœ‰URLé“¾æ¥\n * @param {string} text - è¦å¤„ç†çš„æ–‡æœ¬\n * @returns {string[]} æ‰€æœ‰æ‰¾åˆ°çš„URLé“¾æ¥\n */\nfunction extractAllUrlsFromText(text) {\n    if (!text || typeof text !== 'string') {\n        return [];\n    }\n    \n    const urlRegex = /https?:\\/\\/[^\\s\\\"<>{}|\\\\^`\\[\\]]+/gi;\n    const matches = text.match(urlRegex) || [];\n    \n    console.log(`ğŸ” æ‰¾åˆ° ${matches.length} ä¸ªURLé“¾æ¥`);\n    return matches;\n}\n\n// ä¸»å¤„ç†é€»è¾‘\nlet extractedText = '';\nlet voido_url = null;\nlet all_urls = [];\n\n// 1. ä»Chatæ¶ˆæ¯ä¸­æå–æ–‡æœ¬\nconsole.log('\\n--- æ­¥éª¤1: æå–æ–‡æœ¬å†…å®¹ ---');\nextractedText = extractTextFromChatMessage(chatMessage);\nconsole.log('âœ… æå–åˆ°çš„æ–‡æœ¬:', extractedText.substring(0, 150) + (extractedText.length > 150 ? '...' : ''));\n\n// 2. ä»æ–‡æœ¬ä¸­æå–URL\nconsole.log('\\n--- æ­¥éª¤2: æå–URLé“¾æ¥ ---');\nif (extractedText) {\n    voido_url = extractUrlFromText(extractedText);\n    all_urls = extractAllUrlsFromText(extractedText);\n}\n\n// 3. è¾“å‡ºç»“æœ\nconsole.log('\\n--- æœ€ç»ˆç»“æœ ---');\nif (voido_url) {\n    console.log('ğŸ‰ æˆåŠŸæå–åˆ°voido_url:', voido_url);\n    \n    // URLåˆ†æ\n    console.log('ğŸ“Š URLåˆ†æ:');\n    console.log('  - åè®®:', voido_url.startsWith('https') ? 'HTTPS' : 'HTTP');\n    console.log('  - åŸŸå:', voido_url.split('/')[2]);\n    console.log('  - è·¯å¾„:', voido_url.split('/').slice(3).join('/'));\n    \n    if (all_urls.length > 1) {\n        console.log('  - å…¶ä»–URL:', all_urls.slice(1));\n    }\n} else {\n    console.log('ğŸ’” æœªèƒ½æå–åˆ°URLé“¾æ¥');\n}\n\nconsole.log('\\n=== n8n ChatèŠ‚ç‚¹URLæå–ç»“æŸ ===');\n\n// è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nreturn {\n    voido_url: voido_url,\n    all_urls: all_urls,\n    extracted_text: extractedText,\n    success: !!voido_url,\n    message: voido_url ? `æˆåŠŸæå–${all_urls.length}ä¸ªURL` : 'æœªæ‰¾åˆ°URL',\n    url_count: all_urls.length,\n    original_message: chatMessage\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1696,208],"id":"8ff83c7c-8cbb-4557-93e8-5542a0967a70","name":"æå–URLåœ°å€"},{"parameters":{"assignments":{"assignments":[{"id":"29289767-439a-4e55-9c32-79c9c268335a","name":"platform","value":"={{ $json.platform }}","type":"string"},{"id":"c444a53b-7950-4e91-a224-1a324e209c98","name":"original_data.all_urls","value":"={{ $json.original_data.all_urls }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1248,208],"id":"1cdf135b-33ba-47bf-bfc6-13448d3c9c7b","name":"æ¸…ç†æ•°æ®ï¼Œä¿ç•™å¹³å°ä¿¡æ¯ä¸URL"},{"parameters":{"jsCode":"// n8n FunctionèŠ‚ç‚¹ - URLå¹³å°è¯†åˆ«å™¨\n// ç”¨äºè¯†åˆ«URLå±äºæŠ–éŸ³ã€å°çº¢ä¹¦ã€å¿«æ‰‹ç­‰å¹³å°\n\n// n8nå·¥ä½œæµæ•°æ®æ¥æ”¶\nconst response = $json;\n\nconsole.log('ğŸ” å¼€å§‹URLå¹³å°è¯†åˆ«...');\n\n// æå–URLå‡½æ•°\nfunction extractUrlFromData(data) {\n    if (!data) {\n        console.log('âŒ è¾“å…¥æ•°æ®ä¸ºç©º');\n        return null;\n    }\n    \n    // å¦‚æœæ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•ç›´æ¥æå–URL\n    if (typeof data === 'string') {\n        const urlRegex = /https?:\\/\\/[^\\s\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n        const matches = data.match(urlRegex);\n        if (matches && matches.length > 0) {\n            console.log(`âœ… ä»å­—ç¬¦ä¸²ä¸­æå–åˆ°URL: ${matches[0]}`);\n            return matches[0];\n        }\n    }\n    \n    // å¦‚æœæ•°æ®æ˜¯å¯¹è±¡ï¼Œæ·±åº¦æœç´¢URLå­—æ®µ\n    if (typeof data === 'object' && data !== null) {\n        // ä¼˜å…ˆæœç´¢å¸¸è§URLå­—æ®µ\n        const urlFields = ['url', 'link', 'href', 'video_url', 'douyin_url', 'xiaohongshu_url', 'kuaishou_url'];\n        \n        for (const field of urlFields) {\n            if (data[field] && typeof data[field] === 'string') {\n                const urlRegex = /https?:\\/\\/[^\\s\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n                const matches = data[field].match(urlRegex);\n                if (matches && matches.length > 0) {\n                    console.log(`âœ… ä»å­—æ®µ\"${field}\"ä¸­æå–åˆ°URL: ${matches[0]}`);\n                    return matches[0];\n                }\n            }\n        }\n        \n        // æ·±åº¦æœç´¢å¯¹è±¡ä¸­çš„URL\n        function deepSearch(obj) {\n            if (typeof obj === 'string') {\n                const urlRegex = /https?:\\/\\/[^\\s\"<>{}|\\\\^`\\[\\]\\u4e00-\\u9fffï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š\"â€œâ€â€˜â€™]+/gi;\n                const matches = obj.match(urlRegex);\n                if (matches && matches.length > 0) {\n                    return matches[0];\n                }\n            } else if (typeof obj === 'object' && obj !== null) {\n                for (const key in obj) {\n                    if (obj.hasOwnProperty(key)) {\n                        const result = deepSearch(obj[key]);\n                        if (result) return result;\n                    }\n                }\n            }\n            return null;\n        }\n        \n        const foundUrl = deepSearch(data);\n        if (foundUrl) {\n            console.log(`âœ… æ·±åº¦æœç´¢æ‰¾åˆ°URL: ${foundUrl}`);\n            return foundUrl;\n        }\n    }\n    \n    console.log('âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„URL');\n    return null;\n}\n\n// URLå¹³å°è¯†åˆ«å‡½æ•°\nfunction identifyUrlPlatform(url) {\n    if (!url || typeof url !== 'string') {\n        return { \n            platform: 'invalid', \n            confidence: 0, \n            reason: 'æ— æ•ˆè¾“å…¥',\n            suggestion: 'è¯·æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„URL'\n        };\n    }\n    \n    console.log(`ğŸ” åˆ†æURL: ${url}`);\n    \n    // æŠ–éŸ³å¹³å°è¯†åˆ«è§„åˆ™\n    const douyinPatterns = [\n        /v\\.douyin\\.com/i,\n        /www\\.douyin\\.com/i,\n        /douyin\\.com/i,\n        /\\/D[0-9A-Za-z]{8,}\\/?/i\n    ];\n    \n    // å°çº¢ä¹¦å¹³å°è¯†åˆ«è§„åˆ™\n    const xiaohongshuPatterns = [\n        /www\\.xiaohongshu\\.com/i,\n        /xhslink\\.com/i,\n        /xiaohongshu\\.com/i,\n        /red/i,\n        /\\/discovery\\/item\\/[0-9a-f]+/i\n    ];\n    \n    // å¿«æ‰‹å¹³å°è¯†åˆ«è§„åˆ™\n    const kuaishouPatterns = [\n        /www\\.kuaishou\\.com/i,\n        /kuaishou\\.com/i,\n        /gifshow\\.com/i,\n        /\\/short-video\\//i,\n        /\\/photo\\//i\n    ];\n    \n    // å…¶ä»–å¹³å°è¯†åˆ«è§„åˆ™\n    const otherPlatforms = {\n        'bilibili': [/bilibili\\.com/i, /b23\\.tv/i],\n        'youtube': [/youtube\\.com/i, /youtu\\.be/i],\n        'weibo': [/weibo\\.com/i, /weibo\\.cn/i],\n        'zhihu': [/zhihu\\.com/i],\n        'tiktok': [/tiktok\\.com/i]\n    };\n    \n    // æ£€æŸ¥æŠ–éŸ³\n    for (const pattern of douyinPatterns) {\n        if (pattern.test(url)) {\n            return { \n                platform: 'douyin', \n                confidence: 0.9, \n                reason: 'åŒ¹é…æŠ–éŸ³URLæ¨¡å¼',\n                suggestion: 'è¿™æ˜¯ä¸€ä¸ªæŠ–éŸ³è§†é¢‘é“¾æ¥ï¼Œå¯ä»¥ç”¨äºæŠ–éŸ³ç›¸å…³å¤„ç†'\n            };\n        }\n    }\n    \n    // æ£€æŸ¥å°çº¢ä¹¦\n    for (const pattern of xiaohongshuPatterns) {\n        if (pattern.test(url)) {\n            return { \n                platform: 'xiaohongshu', \n                confidence: 0.9, \n                reason: 'åŒ¹é…å°çº¢ä¹¦URLæ¨¡å¼',\n                suggestion: 'è¿™æ˜¯ä¸€ä¸ªå°çº¢ä¹¦å†…å®¹é“¾æ¥ï¼Œå¯ä»¥ç”¨äºå°çº¢ä¹¦ç›¸å…³å¤„ç†'\n            };\n        }\n    }\n    \n    // æ£€æŸ¥å¿«æ‰‹\n    for (const pattern of kuaishouPatterns) {\n        if (pattern.test(url)) {\n            return { \n                platform: 'kuaishou', \n                confidence: 0.9, \n                reason: 'åŒ¹é…å¿«æ‰‹URLæ¨¡å¼',\n                suggestion: 'è¿™æ˜¯ä¸€ä¸ªå¿«æ‰‹è§†é¢‘é“¾æ¥ï¼Œå¯ä»¥ç”¨äºå¿«æ‰‹ç›¸å…³å¤„ç†'\n            };\n        }\n    }\n    \n    // æ£€æŸ¥å…¶ä»–å¹³å°\n    for (const [platform, patterns] of Object.entries(otherPlatforms)) {\n        for (const pattern of patterns) {\n            if (pattern.test(url)) {\n                return { \n                    platform: platform, \n                    confidence: 0.8, \n                    reason: `åŒ¹é…${platform} URLæ¨¡å¼`,\n                    suggestion: `è¿™æ˜¯ä¸€ä¸ª${platform}é“¾æ¥ï¼Œå¯ä»¥ç”¨äº${platform}ç›¸å…³å¤„ç†`\n                };\n            }\n        }\n    }\n    \n    // é€šç”¨URLåˆ†æ\n    try {\n        const urlObj = new URL(url);\n        const domain = urlObj.hostname;\n        \n        if (domain.includes('douyin')) {\n            return { \n                platform: 'douyin', \n                confidence: 0.7, \n                reason: 'åŸŸååŒ…å«douyin',\n                suggestion: 'è¿™å¯èƒ½æ˜¯æŠ–éŸ³ç›¸å…³é“¾æ¥ï¼Œå»ºè®®è¿›ä¸€æ­¥éªŒè¯'\n            };\n        }\n        \n        if (domain.includes('xiaohongshu') || domain.includes('red')) {\n            return { \n                platform: 'xiaohongshu', \n                confidence: 0.7, \n                reason: 'åŸŸååŒ…å«å°çº¢ä¹¦ç›¸å…³å…³é”®è¯',\n                suggestion: 'è¿™å¯èƒ½æ˜¯å°çº¢ä¹¦ç›¸å…³é“¾æ¥ï¼Œå»ºè®®è¿›ä¸€æ­¥éªŒè¯'\n            };\n        }\n        \n        if (domain.includes('kuaishou') || domain.includes('gifshow')) {\n            return { \n                platform: 'kuaishou', \n                confidence: 0.7, \n                reason: 'åŸŸååŒ…å«å¿«æ‰‹ç›¸å…³å…³é”®è¯',\n                suggestion: 'è¿™å¯èƒ½æ˜¯å¿«æ‰‹ç›¸å…³é“¾æ¥ï¼Œå»ºè®®è¿›ä¸€æ­¥éªŒè¯'\n            };\n        }\n        \n        return { \n            platform: 'unknown', \n            confidence: 0.3, \n            reason: `æ— æ³•è¯†åˆ«çš„åŸŸå: ${domain}`,\n            suggestion: 'è¿™æ˜¯ä¸€ä¸ªæœªçŸ¥å¹³å°çš„é“¾æ¥ï¼Œå¯èƒ½éœ€è¦è‡ªå®šä¹‰å¤„ç†'\n        };\n        \n    } catch (error) {\n        return { \n            platform: 'invalid', \n            confidence: 0, \n            reason: 'æ— æ•ˆçš„URLæ ¼å¼',\n            suggestion: 'è¯·æ£€æŸ¥URLæ ¼å¼æ˜¯å¦æ­£ç¡®'\n        };\n    }\n}\n\n// è·å–å¹³å°å¤„ç†å»ºè®®\nfunction getPlatformSuggestion(platform) {\n    const suggestions = {\n        'douyin': {\n            action: 'æŠ–éŸ³è§†é¢‘å¤„ç†',\n            steps: ['è§£æè§†é¢‘ID', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘å†…å®¹'],\n            tools: ['æŠ–éŸ³API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'xiaohongshu': {\n            action: 'å°çº¢ä¹¦å†…å®¹å¤„ç†',\n            steps: ['è§£æç¬”è®°ID', 'è·å–ç¬”è®°è¯¦æƒ…', 'æå–å›¾ç‰‡/æ–‡å­—'],\n            tools: ['å°çº¢ä¹¦API', 'å†…å®¹è§£æå™¨']\n        },\n        'kuaishou': {\n            action: 'å¿«æ‰‹è§†é¢‘å¤„ç†',\n            steps: ['è§£æè§†é¢‘ID', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘å†…å®¹'],\n            tools: ['å¿«æ‰‹API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'bilibili': {\n            action: 'Bç«™è§†é¢‘å¤„ç†',\n            steps: ['è§£æBVå·', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘'],\n            tools: ['Bç«™API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'youtube': {\n            action: 'YouTubeè§†é¢‘å¤„ç†',\n            steps: ['è§£æè§†é¢‘ID', 'è·å–è§†é¢‘ä¿¡æ¯', 'ä¸‹è½½è§†é¢‘'],\n            tools: ['YouTube API', 'è§†é¢‘ä¸‹è½½å™¨']\n        },\n        'unknown': {\n            action: 'é€šç”¨é“¾æ¥å¤„ç†',\n            steps: ['åˆ†æé“¾æ¥ç»“æ„', 'æå–å…³é”®ä¿¡æ¯', 'è‡ªå®šä¹‰å¤„ç†'],\n            tools: ['é€šç”¨çˆ¬è™«', 'è‡ªå®šä¹‰è§£æå™¨']\n        }\n    };\n    \n    return suggestions[platform] || {\n        action: 'æœªçŸ¥å¹³å°å¤„ç†',\n        steps: ['åˆ†æé“¾æ¥ç‰¹å¾', 'ç¡®å®šå¤„ç†ç­–ç•¥'],\n        tools: ['é€šç”¨å·¥å…·']\n    };\n}\n\n// ä¸»å¤„ç†é€»è¾‘\nfunction main() {\n    console.log('ğŸ“¥ æ¥æ”¶åˆ°çš„æ•°æ®:', JSON.stringify(response, null, 2));\n    \n    // æå–URL\n    const url = extractUrlFromData(response);\n    \n    if (!url) {\n        return {\n            success: false,\n            message: 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„URL',\n            original_data: response,\n            platform: 'none',  // æ— URLæ—¶çš„å¹³å°æ ‡è¯†\n            platform_info: {\n                platform: 'none',\n                confidence: 0,\n                reason: 'æœªæ‰¾åˆ°URL',\n                suggestion: 'è¯·ç¡®ä¿è¾“å…¥æ•°æ®åŒ…å«æœ‰æ•ˆçš„URLé“¾æ¥'\n            }\n        };\n    }\n    \n    // è¯†åˆ«å¹³å°\n    const platformResult = identifyUrlPlatform(url);\n    \n    // è·å–å¤„ç†å»ºè®®\n    const suggestion = getPlatformSuggestion(platformResult.platform);\n    \n    console.log(`ğŸ¯ è¯†åˆ«ç»“æœ: ${platformResult.platform} (ç½®ä¿¡åº¦: ${platformResult.confidence})`);\n    console.log(`ğŸ“ åŸå› : ${platformResult.reason}`);\n    console.log(`ğŸ’¡ å»ºè®®: ${platformResult.suggestion}`);\n    \n    return {\n        success: true,\n        message: 'URLå¹³å°è¯†åˆ«æˆåŠŸ',\n        original_data: response,\n        url: url,\n        platform: platformResult.platform,  // ç›´æ¥å¹³å°æ ‡è¯†ï¼šdouyin, xiaohongshu, kuaishou, bilibiliç­‰\n        platform_info: platformResult,\n        processing_suggestion: suggestion\n    };\n}\n\n// æ‰§è¡Œä¸»å‡½æ•°å¹¶è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nconst result = main();\nconsole.log('âœ… URLå¹³å°è¯†åˆ«å®Œæˆ');\n\nreturn result;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1472,208],"id":"9fb3b040-9c08-4b1f-a53b-ab13713bef37","name":"è·å–å¹³å°ä¿¡æ¯"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"leftValue":"={{ $json.platform }}","rightValue":"douyin","operator":{"type":"string","operation":"equals"},"id":"cfda8ab8-ee00-4101-b395-561d0c6cf25f"}],"combinator":"and"},"renameOutput":true,"outputKey":"douyin"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"2fdbc1f3-d2b7-4fa1-ad5d-a7c4755d1ca7","leftValue":"={{ $json.platform }}","rightValue":"xiaohongshu","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"xiaohongshu"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"1f949a8b-ffea-4ec6-9cae-8bb0ffd77cd7","leftValue":"={{ $json.platform }}","rightValue":"kuaishou","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"kuaishou"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"6602bd66-0403-4bb9-ba59-79341e2736cd","leftValue":"={{ $json.platform }}","rightValue":"bilibili","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"bilibili"}]},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[-1024,176],"id":"f107a45b-dbd0-4367-ba6c-7ee98c958ad0","name":"æ ¹æ®ä¿¡æ¯é€‰æ‹©å¯¹åº”å·¥ä½œæµ"},{"parameters":{"url":"https://api.bugpk.com/api/douyin","sendQuery":true,"queryParameters":{"parameters":[{"name":"=url","value":"={{ $json.original_data.all_urls[0] }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Accept","value":"application/json"}]},"options":{"allowUnauthorizedCerts":true}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-800,112],"id":"8a3eaf45-acb1-4a1e-8389-52b9cdc47e42","name":"æŠ–éŸ³è§†é¢‘è§£æè·å–åœ°å€"},{"parameters":{"url":"https://api.bugpk.com/api/xhsjx","sendQuery":true,"queryParameters":{"parameters":[{"name":"=url","value":"={{ $json.original_data.all_urls[0] }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Accept","value":"application/json"}]},"options":{"allowUnauthorizedCerts":true}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-800,304],"id":"ad7d9cad-0a95-4f40-988c-a2667fbab684","name":"å°çº¢ä¹¦è§£æè·å–åœ°å€"},{"parameters":{"jsCode":"// n8n FunctionèŠ‚ç‚¹ - æ£€æŸ¥JSONæ•°æ®ä¸­çš„imgurlå‚æ•°\n// å¦‚æœæœ‰imgurlå‚æ•°ï¼Œè¿”å›imgurlå’Œå†…å®¹ï¼›å¦‚æœæ²¡æœ‰ï¼Œè¿”å›urlå’Œå†…å®¹\n\n// n8nå·¥ä½œæµæ•°æ®æ¥æ”¶\nconst response = $json;\n\nconsole.log('ğŸ” å¼€å§‹æ£€æŸ¥JSONæ•°æ®ä¸­çš„å›¾ç‰‡å‚æ•°...');\n\n// ä¸»å¤„ç†å‡½æ•°\nfunction checkImgUrlParameter(data) {\n    console.log('ğŸ“¥ è¾“å…¥æ•°æ®:', JSON.stringify(data, null, 2));\n    \n    // æ£€æŸ¥æ•°æ®æ ¼å¼\n    if (!data || typeof data !== 'object') {\n        return {\n            success: false,\n            message: 'è¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null\n        };\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰dataå­—æ®µ\n    if (!data.data || typeof data.data !== 'object') {\n        return {\n            success: false,\n            message: 'ç¼ºå°‘dataå­—æ®µæˆ–dataå­—æ®µæ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null\n        };\n    }\n    \n    const dataObj = data.data;\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰imgurlå‚æ•°\n    if (dataObj.hasOwnProperty('imgurl')) {\n        console.log('âœ… æ‰¾åˆ°imgurlå‚æ•°');\n        \n        // å¤„ç†imgurlå†…å®¹\n        let imgurlContent = dataObj.imgurl;\n        \n        // å¦‚æœimgurlæ˜¯æ•°ç»„ï¼Œå¤„ç†æ•°ç»„å†…å®¹\n        if (Array.isArray(imgurlContent)) {\n            console.log(`ğŸ“· imgurlæ˜¯æ•°ç»„ï¼ŒåŒ…å« ${imgurlContent.length} ä¸ªå…ƒç´ `);\n            \n            // æ¸…ç†å’Œæ ¼å¼åŒ–æ•°ç»„å†…å®¹\n            const cleanedImgUrls = imgurlContent.map(url => {\n                // å»é™¤URLä¸¤ç«¯çš„ç©ºæ ¼å’Œåå¼•å·\n                return url.trim().replace(/^`|`$/g, '').trim();\n            });\n            \n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imgurlå‚æ•°ï¼ˆæ•°ç»„æ ¼å¼ï¼‰',\n                parameter_type: 'imgurl',\n                parameter_value: cleanedImgUrls,\n                count: cleanedImgUrls.length,\n                result: {\n                    imgurl: cleanedImgUrls\n                }\n            };\n        } \n        // å¦‚æœimgurlæ˜¯å­—ç¬¦ä¸²\n        else if (typeof imgurlContent === 'string') {\n            console.log('ğŸ“· imgurlæ˜¯å­—ç¬¦ä¸²');\n            \n            // æ¸…ç†å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å†…å®¹\n            const cleanedImgUrl = imgurlContent.trim().replace(/^`|`$/g, '').trim();\n            \n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imgurlå‚æ•°ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰',\n                parameter_type: 'imgurl',\n                parameter_value: cleanedImgUrl,\n                count: 1,\n                result: {\n                    imgurl: cleanedImgUrl\n                }\n            };\n        }\n        // å…¶ä»–æ ¼å¼çš„imgurl\n        else {\n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imgurlå‚æ•°ï¼ˆå…¶ä»–æ ¼å¼ï¼‰',\n                parameter_type: 'imgurl',\n                parameter_value: imgurlContent,\n                count: 1,\n                result: {\n                    imgurl: imgurlContent\n                }\n            };\n        }\n    }\n    // æ£€æŸ¥æ˜¯å¦æœ‰urlå‚æ•°\n    else if (dataObj.hasOwnProperty('url')) {\n        console.log('âœ… æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°');\n        \n        let urlContent = dataObj.url;\n        \n        // å¤„ç†urlå†…å®¹\n        if (typeof urlContent === 'string') {\n            const cleanedUrl = urlContent.trim().replace(/^`|`$/g, '').trim();\n            \n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: cleanedUrl,\n                count: 1,\n                result: {\n                    url: cleanedUrl\n                }\n            };\n        } else {\n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: urlContent,\n                count: 1,\n                result: {\n                    url: urlContent\n                }\n            };\n        }\n    }\n    // æ£€æŸ¥å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n    else {\n        console.log('ğŸ” æœªæ‰¾åˆ°imgurlå’Œurlå‚æ•°ï¼Œæœç´¢å…¶ä»–å›¾ç‰‡ç›¸å…³å­—æ®µ...');\n        \n        // æœç´¢å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n        const imageFields = ['image', 'cover', 'avatar', 'picture', 'pic', 'thumbnail'];\n        let foundField = null;\n        let foundValue = null;\n        \n        for (const field of imageFields) {\n            if (dataObj.hasOwnProperty(field)) {\n                foundField = field;\n                foundValue = dataObj[field];\n                break;\n            }\n        }\n        \n        if (foundField) {\n            console.log(`âœ… æ‰¾åˆ°æ›¿ä»£å­—æ®µ: ${foundField}`);\n            \n            // å¤„ç†æ‰¾åˆ°çš„å­—æ®µå†…å®¹\n            if (typeof foundValue === 'string') {\n                const cleanedValue = foundValue.trim().replace(/^`|`$/g, '').trim();\n                \n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: cleanedValue,\n                    count: 1,\n                    result: {\n                        [foundField]: cleanedValue\n                    }\n                };\n            } else {\n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imgurlå‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: foundValue,\n                    count: 1,\n                    result: {\n                        [foundField]: foundValue\n                    }\n                };\n            }\n        } else {\n            console.log('âŒ æœªæ‰¾åˆ°ä»»ä½•å›¾ç‰‡ç›¸å…³å‚æ•°');\n            \n            return {\n                success: false,\n                message: 'æœªæ‰¾åˆ°imgurlã€urlæˆ–å…¶ä»–å›¾ç‰‡ç›¸å…³å‚æ•°',\n                parameter_type: 'none',\n                parameter_value: null,\n                count: 0,\n                result: null\n            };\n        }\n    }\n}\n\n// æ‰§è¡Œä¸»å‡½æ•°\nconsole.log('ğŸ¯ å¼€å§‹å¤„ç†n8nå·¥ä½œæµæ•°æ®...');\nconst result = checkImgUrlParameter(response);\n\nconsole.log('ğŸ“Š å¤„ç†ç»“æœ:');\nconsole.log(`  - æˆåŠŸ: ${result.success}`);\nconsole.log(`  - æ¶ˆæ¯: ${result.message}`);\nconsole.log(`  - å‚æ•°ç±»å‹: ${result.parameter_type}`);\nconsole.log(`  - æ•°é‡: ${result.count}`);\n\nif (result.success && result.result) {\n    console.log(`  - è¿”å›å†…å®¹: ${JSON.stringify(result.result, null, 2)}`);\n}\n\nconsole.log('âœ… JSONæ•°æ®æ£€æŸ¥å®Œæˆ');\n\n// è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nreturn result;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-576,304],"id":"d1999dd8-0b74-4879-9b2d-579611b8f6f6","name":"Code in JavaScript"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.parameter_type }}","rightValue":"imgurl","operator":{"type":"string","operation":"equals"},"id":"b044f1ca-d03c-4a69-99f2-a7eb70763c4f"}],"combinator":"and"},"renameOutput":true,"outputKey":"imgurl"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ccb7c462-386a-4010-8208-c6befda57001","leftValue":"={{ $json.parameter_type }}","rightValue":"url","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"url"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[-352,304],"id":"6dc7a042-849e-4b24-9ab9-bf154a6f8bb9","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"20abeee6-b5a5-46f9-b885-ed62786f134c","name":"url","value":"={{ $json.result.url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,432],"id":"6fb9d3bc-75d0-49c6-b439-490fc354a724","name":"å°çº¢ä¹¦è§†é¢‘è§£æ"},{"parameters":{"assignments":{"assignments":[{"id":"f70cb110-186a-487c-bf6d-1f1017f9b1c5","name":"images","value":"={{ $json.result.imgurl }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,144],"id":"7c1a04bd-4b78-4176-a6fa-590785fb293e","name":"å°çº¢ä¹¦å›¾ç‰‡è§£æ"},{"parameters":{"jsCode":"// n8n FunctionèŠ‚ç‚¹ - æ£€æŸ¥JSONæ•°æ®ä¸­çš„imageså‚æ•°\n// å¦‚æœæœ‰imageså‚æ•°ï¼Œè¿”å›imageså’Œå†…å®¹ï¼›å¦‚æœæ²¡æœ‰ï¼Œè¿”å›urlå’Œå†…å®¹\n\n// n8nå·¥ä½œæµæ•°æ®æ¥æ”¶\nconst response = $json;\n\nconsole.log('ğŸ” å¼€å§‹æ£€æŸ¥JSONæ•°æ®ä¸­çš„å›¾ç‰‡å‚æ•°...');\n\n// ä¸»å¤„ç†å‡½æ•°\nfunction checkImagesParameter(data) {\n    console.log('ğŸ“¥ è¾“å…¥æ•°æ®:', JSON.stringify(data, null, 2));\n    \n    // æ£€æŸ¥æ•°æ®æ ¼å¼\n    if (!data || typeof data !== 'object') {\n        return {\n            success: false,\n            message: 'è¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null,\n            count: 0\n        };\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰dataå­—æ®µ\n    if (!data.data || typeof data.data !== 'object') {\n        return {\n            success: false,\n            message: 'ç¼ºå°‘dataå­—æ®µæˆ–dataå­—æ®µæ ¼å¼é”™è¯¯',\n            result: null,\n            parameter_type: 'invalid',\n            parameter_value: null,\n            count: 0\n        };\n    }\n    \n    const dataObj = data.data;\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰imageså‚æ•°ä¸”ä¸ä¸ºç©º\n    if (dataObj.hasOwnProperty('images') && dataObj.images != null) {\n        console.log('âœ… æ‰¾åˆ°imageså‚æ•°');\n        \n        // å¤„ç†imageså†…å®¹\n        let imagesContent = dataObj.images;\n        \n        // æ£€æŸ¥imagesæ˜¯å¦ä¸ºç©º\n        let isEmpty = false;\n        \n        // å¦‚æœimagesæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºç©ºæ•°ç»„\n        if (Array.isArray(imagesContent)) {\n            if (imagesContent.length === 0) {\n                console.log('âš ï¸ imagesæ˜¯ç©ºæ•°ç»„ï¼Œè§†ä¸ºä¸å­˜åœ¨');\n                isEmpty = true;\n            } else {\n                console.log(`ğŸ“· imagesæ˜¯æ•°ç»„ï¼ŒåŒ…å« ${imagesContent.length} ä¸ªå…ƒç´ `);\n                \n                // æ¸…ç†å’Œæ ¼å¼åŒ–æ•°ç»„å†…å®¹\n                const cleanedImages = imagesContent.map(url => {\n                    // å»é™¤URLä¸¤ç«¯çš„ç©ºæ ¼å’Œåå¼•å·\n                    return url.trim().replace(/^`|`$/g, '').trim();\n                });\n                \n                return {\n                    success: true,\n                    message: 'æ‰¾åˆ°imageså‚æ•°ï¼ˆæ•°ç»„æ ¼å¼ï¼‰',\n                    parameter_type: 'images',\n                    parameter_value: cleanedImages,\n                    count: cleanedImages.length,\n                    result: {\n                        images: cleanedImages\n                    }\n                };\n            }\n        } \n        // å¦‚æœimagesæ˜¯å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²\n        else if (typeof imagesContent === 'string') {\n            if (imagesContent.trim() === '') {\n                console.log('âš ï¸ imagesæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè§†ä¸ºä¸å­˜åœ¨');\n                isEmpty = true;\n            } else {\n                console.log('ğŸ“· imagesæ˜¯å­—ç¬¦ä¸²');\n                \n                // æ¸…ç†å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å†…å®¹\n                const cleanedImage = imagesContent.trim().replace(/^`|`$/g, '').trim();\n                \n                return {\n                    success: true,\n                    message: 'æ‰¾åˆ°imageså‚æ•°ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰',\n                    parameter_type: 'images',\n                    parameter_value: cleanedImage,\n                    count: 1,\n                    result: {\n                        images: cleanedImage\n                    }\n                };\n            }\n        }\n        // å…¶ä»–æ ¼å¼çš„imagesï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºnullæˆ–undefined\n        else if (imagesContent === null || imagesContent === undefined) {\n            console.log('âš ï¸ imagesæ˜¯nullæˆ–undefinedï¼Œè§†ä¸ºä¸å­˜åœ¨');\n            isEmpty = true;\n        }\n        // å…¶ä»–æ ¼å¼çš„images\n        else {\n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imageså‚æ•°ï¼ˆå…¶ä»–æ ¼å¼ï¼‰',\n                parameter_type: 'images',\n                parameter_value: imagesContent,\n                count: 1,\n                result: {\n                    images: imagesContent\n                }\n            };\n        }\n        \n        // å¦‚æœimagesä¸ºç©ºï¼Œç»§ç»­æ£€æŸ¥å…¶ä»–å‚æ•°\n        if (isEmpty) {\n            console.log('ğŸ” imageså‚æ•°ä¸ºç©ºï¼Œç»§ç»­æ£€æŸ¥å…¶ä»–å‚æ•°...');\n        } else {\n            // å¦‚æœimagesä¸ä¸ºç©ºï¼Œç›´æ¥è¿”å›ç»“æœ\n            return {\n                success: true,\n                message: 'æ‰¾åˆ°imageså‚æ•°',\n                parameter_type: 'images',\n                parameter_value: imagesContent,\n                count: 1,\n                result: {\n                    images: imagesContent\n                }\n            };\n        }\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰urlå‚æ•°ä¸”ä¸ä¸ºç©º\n    if (dataObj.hasOwnProperty('url') && dataObj.url != null) {\n        console.log('âœ… æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°');\n        \n        let urlContent = dataObj.url;\n        \n        // å¤„ç†urlå†…å®¹\n        if (typeof urlContent === 'string') {\n            const cleanedUrl = urlContent.trim().replace(/^`|`$/g, '').trim();\n            \n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: cleanedUrl,\n                count: 1,\n                result: {\n                    url: cleanedUrl\n                }\n            };\n        } else {\n            return {\n                success: true,\n                message: 'æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°urlå‚æ•°',\n                parameter_type: 'url',\n                parameter_value: urlContent,\n                count: 1,\n                result: {\n                    url: urlContent\n                }\n            };\n        }\n    }\n    // æ£€æŸ¥å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n    else {\n        console.log('ğŸ” æœªæ‰¾åˆ°imageså’Œurlå‚æ•°ï¼Œæœç´¢å…¶ä»–å›¾ç‰‡ç›¸å…³å­—æ®µ...');\n        \n        // æœç´¢å…¶ä»–å¯èƒ½çš„å›¾ç‰‡URLå­—æ®µ\n        const imageFields = ['image', 'cover', 'avatar', 'picture', 'pic', 'thumbnail', 'imgurl'];\n        let foundField = null;\n        let foundValue = null;\n        \n        for (const field of imageFields) {\n            if (dataObj.hasOwnProperty(field)) {\n                foundField = field;\n                foundValue = dataObj[field];\n                break;\n            }\n        }\n        \n        if (foundField) {\n            console.log(`âœ… æ‰¾åˆ°æ›¿ä»£å­—æ®µ: ${foundField}`);\n            \n            // å¤„ç†æ‰¾åˆ°çš„å­—æ®µå†…å®¹\n            if (typeof foundValue === 'string') {\n                const cleanedValue = foundValue.trim().replace(/^`|`$/g, '').trim();\n                \n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: cleanedValue,\n                    count: 1,\n                    result: {\n                        [foundField]: cleanedValue\n                    }\n                };\n            } else {\n                return {\n                    success: true,\n                    message: `æœªæ‰¾åˆ°imageså‚æ•°ï¼Œä½†æ‰¾åˆ°${foundField}å‚æ•°`,\n                    parameter_type: foundField,\n                    parameter_value: foundValue,\n                    count: 1,\n                    result: {\n                        [foundField]: foundValue\n                    }\n                };\n            }\n        } else {\n            console.log('âŒ æœªæ‰¾åˆ°ä»»ä½•å›¾ç‰‡ç›¸å…³å‚æ•°');\n            \n            return {\n                success: false,\n                message: 'æœªæ‰¾åˆ°imagesã€urlæˆ–å…¶ä»–å›¾ç‰‡ç›¸å…³å‚æ•°',\n                parameter_type: 'none',\n                parameter_value: null,\n                count: 0,\n                result: null\n            };\n        }\n    }\n}\n\n// æ‰§è¡Œä¸»å‡½æ•°\nconsole.log('ğŸ¯ å¼€å§‹å¤„ç†n8nå·¥ä½œæµæ•°æ®...');\nconst result = checkImagesParameter(response);\n\nconsole.log('ğŸ“Š å¤„ç†ç»“æœ:');\nconsole.log(`  - æˆåŠŸ: ${result.success}`);\nconsole.log(`  - æ¶ˆæ¯: ${result.message}`);\nconsole.log(`  - å‚æ•°ç±»å‹: ${result.parameter_type}`);\nconsole.log(`  - æ•°é‡: ${result.count}`);\n\nif (result.success && result.result) {\n    console.log(`  - è¿”å›å†…å®¹: ${JSON.stringify(result.result, null, 2)}`);\n}\n\nconsole.log('âœ… JSONæ•°æ®æ£€æŸ¥å®Œæˆ');\n\n// è¿”å›ç»“æœç»™n8nå·¥ä½œæµ\nreturn result;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-592,112],"id":"8583360d-7c56-4734-8dd5-f61a658cfb24","name":"Code in JavaScript1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.parameter_type }}","rightValue":"images","operator":{"type":"string","operation":"equals"},"id":"34bc6e42-7808-4669-862f-fee0b11f0c87"}],"combinator":"and"},"renameOutput":true,"outputKey":"images"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"065c7439-48cf-409f-bf40-c9c985bd9e94","leftValue":"={{ $json.parameter_type }}","rightValue":"url","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"url"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[-384,112],"id":"aae02ae5-9b6d-41a2-ae0a-9ddface7094b","name":"Switch1"},{"parameters":{"assignments":{"assignments":[{"id":"b3ef2a19-e2cd-4d48-96e0-f34fdcc51df0","name":"images","value":"={{ $json.result.images }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,0],"id":"fb130098-be10-4044-9000-41e7d62f1cdc","name":"æŠ–éŸ³å›¾ç‰‡è§£æ"},{"parameters":{"assignments":{"assignments":[{"id":"4d042191-8af8-4937-ae4c-301bb07a5028","name":"url","value":"={{ $json.result.url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,288],"id":"d5ad7c76-9b2b-4daa-b701-6911759b40c6","name":"æŠ–éŸ³è§†é¢‘è§£æ"},{"parameters":{"aggregate":"aggregateAllItemData","options":{"includeBinaries":true}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[304,64],"id":"98880f8f-be19-4f00-ab3e-afe1854412ef","name":"Aggregate"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[304,352],"id":"592005f9-2188-45d2-9c0d-18ae6f79ecc8","name":"Aggregate1"},{"parameters":{"httpMethod":"POST","path":"parserAll","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1952,208],"id":"f9f2bacf-51cb-4b0f-a7b7-6929d54fe702","name":"Webhook","webhookId":"2913aca4-3fb9-4ad9-a5ee-09f50d10aea1"},{"parameters":{"respondWith":"allIncomingItems","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[608,64],"id":"ee2e4361-9a94-4801-bd41-ae25e6ab01be","name":"Respond to Webhook"},{"parameters":{"respondWith":"allIncomingItems","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[608,352],"id":"8aac7940-1008-420b-983d-889562f85e55","name":"Respond to Webhook1"}],"connections":{"æå–URLåœ°å€":{"main":[[{"node":"è·å–å¹³å°ä¿¡æ¯","type":"main","index":0}]]},"è·å–å¹³å°ä¿¡æ¯":{"main":[[{"node":"æ¸…ç†æ•°æ®ï¼Œä¿ç•™å¹³å°ä¿¡æ¯ä¸URL","type":"main","index":0}]]},"æ¸…ç†æ•°æ®ï¼Œä¿ç•™å¹³å°ä¿¡æ¯ä¸URL":{"main":[[{"node":"æ ¹æ®ä¿¡æ¯é€‰æ‹©å¯¹åº”å·¥ä½œæµ","type":"main","index":0}]]},"æ ¹æ®ä¿¡æ¯é€‰æ‹©å¯¹åº”å·¥ä½œæµ":{"main":[[{"node":"æŠ–éŸ³è§†é¢‘è§£æè·å–åœ°å€","type":"main","index":0}],[{"node":"å°çº¢ä¹¦è§£æè·å–åœ°å€","type":"main","index":0}]]},"æŠ–éŸ³è§†é¢‘è§£æè·å–åœ°å€":{"main":[[{"node":"Code in JavaScript1","type":"main","index":0}]]},"å°çº¢ä¹¦è§£æè·å–åœ°å€":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"å°çº¢ä¹¦å›¾ç‰‡è§£æ","type":"main","index":0}],[{"node":"å°çº¢ä¹¦è§†é¢‘è§£æ","type":"main","index":0}]]},"Code in JavaScript1":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"æŠ–éŸ³å›¾ç‰‡è§£æ","type":"main","index":0}],[{"node":"æŠ–éŸ³è§†é¢‘è§£æ","type":"main","index":0}]]},"æŠ–éŸ³è§†é¢‘è§£æ":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"å°çº¢ä¹¦è§†é¢‘è§£æ":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"æŠ–éŸ³å›¾ç‰‡è§£æ":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"å°çº¢ä¹¦å›¾ç‰‡è§£æ":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"æå–URLåœ°å€","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]}},"authors":"å†· å¸ƒä¸","name":"Version 65676e64","description":"","workflowPublishHistory":[{"createdAt":"2025-12-16T12:40:44.761Z","id":1,"workflowId":"7QXGhmxnsH4ncMJS","versionId":"65676e64-145e-4f0c-80c9-e4d128aa3b49","event":"activated","userId":"c46ce840-de81-412d-a160-69fb3885a0dd"}]}}
