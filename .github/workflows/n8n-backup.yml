- name: 导出n8n工作流
  env:
    N8N_API_KEY: ${{ secrets.N8N_API_KEY }}
    N8N_URL: "https://n8n.lbuding.com"
  run: |
    # 新增：先请求工作流列表，保存返回内容并输出（调试用）
    RESPONSE=$(curl -s -X GET "$N8N_URL/api/v1/workflows" \
      -H "Authorization: Bearer $N8N_API_KEY" \
      -H "Content-Type: application/json")
    # 输出返回内容，方便排查问题
    echo "===== n8n API返回内容 ====="
    echo "$RESPONSE"
    echo "==========================="
    
    # 原来的逻辑（暂时保留，看报错后的返回内容）
    WORKFLOW_IDS=$(echo "$RESPONSE" | jq -r '.[].id')
    
    for ID in $WORKFLOW_IDS; do
      WORKFLOW_NAME=$(curl -s -X GET "$N8N_URL/api/v1/workflows/$ID" \
        -H "Authorization: Bearer $N8N_API_KEY" \
        | jq -r '.name' | sed 's/[^a-zA-Z0-9_-]/_/g')
      curl -s -X GET "$N8N_URL/api/v1/workflows/$ID/export" \
        -H "Authorization: Bearer $N8N_API_KEY" \
        -o ./backups/$(date +%Y-%m-%d_%H-%M-%S)/$WORKFLOW_NAME-$ID.json
    done
